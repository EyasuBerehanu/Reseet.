# Camera Flow - Visual Guide

## âœ… Updated Configuration

**AI Model:** `google/gemini-2.0-flash-001` (as requested)

---

## ğŸ“¸ Complete User Flow

### Step 1: Scan Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [X] Close                   â”‚
â”‚                                     â”‚
â”‚   "Position receipt within frame"   â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚         â”‚
â”‚    â”‚  â•‘               â•‘  â”‚         â”‚
â”‚    â”‚  â•‘               â•‘  â”‚         â”‚
â”‚    â”‚  â•‘   ğŸ“· Camera   â•‘  â”‚         â”‚
â”‚    â”‚  â•‘   Viewfinder  â•‘  â”‚         â”‚
â”‚    â”‚  â•‘               â•‘  â”‚         â”‚
â”‚    â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                     â”‚
â”‚  "We'll turn this into a clean      â”‚
â”‚   digital receipt..."               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“· Scan Receipt            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ–¼ï¸  Choose from Library    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Processing (after taking photo)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚                                     â”‚
â”‚          â³ (spinning)              â”‚
â”‚                                     â”‚
â”‚      Analyzing receipt...           â”‚
â”‚                                     â”‚
â”‚    This may take a few seconds      â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
**Duration:** 2-5 seconds

### Step 3: Confirmation Screen (Read-Only Summary)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [X]  Confirm Receipt            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Merchant                           â”‚
â”‚  Starbucks Coffee                   â”‚
â”‚                                     â”‚
â”‚  Date              Category         â”‚
â”‚  Jan 15, 2024      [Food]           â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Total Amount                       â”‚
â”‚  $12.45                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Items                              â”‚
â”‚  Latte........................ $5.95â”‚
â”‚  Qty: 1                             â”‚
â”‚                                     â”‚
â”‚  Sandwich.................... $5.55â”‚
â”‚  Qty: 1                             â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  Subtotal................... $11.50â”‚
â”‚  Tax......................... $0.95â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Write-off Score                    â”‚
â”‚  35%                                â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (red)       â”‚
â”‚  Low likelihood to qualify          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [ â†» Retake ]  [ âœ“ Looks Good ]   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Note:** All fields are **display-only** (not editable)

---

## ğŸ¯ User Actions

### On Confirmation Screen:

#### Option 1: Retake
```
User taps "Retake"
    â†“
Returns to Scan Screen
    â†“
Can take new photo
```

#### Option 2: Looks Good
```
User taps "Looks Good"
    â†“
Receipt saved to app
    â†“
Returns to Home Screen
    â†“
Receipt appears in list
```

---

## ğŸ“Š What Gets Extracted (Non-Editable)

| Field | Example | Editable? |
|-------|---------|-----------|
| Merchant | "Starbucks Coffee" | âŒ No |
| Date | "Jan 15, 2024" | âŒ No |
| Category | "Food" | âŒ No |
| Total | $12.45 | âŒ No |
| Items | Latte - $5.95 | âŒ No |
| Subtotal | $11.50 | âŒ No |
| Tax | $0.95 | âŒ No |
| Score | 35% | âŒ No |

**All data is read-only.** User can only:
- âœ… Accept the data ("Looks Good")
- âœ… Reject and retake ("Retake")

---

## ğŸ¤– AI Processing Details

### Model Configuration
```typescript
{
  model: 'google/gemini-2.0-flash-001',
  temperature: 0.1,  // Low = consistent results
  max_tokens: 2000
}
```

### What AI Sees
1. Base64-encoded receipt image
2. Instructions to extract:
   - Merchant name
   - Date (MMM DD, YYYY format)
   - Category (Food/Supplies/Travel/Fuel/General)
   - Items with prices and quantities
   - Subtotal, tax, total

### What AI Returns
```json
{
  "merchant": "Starbucks Coffee",
  "date": "Jan 15, 2024",
  "category": "Food",
  "total": 12.45,
  "subtotal": 11.50,
  "tax": 0.95,
  "items": [
    { "description": "Latte", "price": 5.95, "quantity": 1 },
    { "description": "Sandwich", "price": 5.55, "quantity": 1 }
  ]
}
```

---

## ğŸ¨ Visual States

### 1. Idle State (Waiting for Photo)
- Black background
- White viewfinder frame
- Corner markers
- Helper text visible
- Buttons enabled

### 2. Processing State
- Dark overlay (70% opacity)
- Spinning loader
- "Analyzing receipt..." text
- Buttons disabled

### 3. Error State
- Red error banner at bottom
- Error message displayed
- Buttons re-enabled
- Can retry

### 4. Confirmation State
- White background
- Clean card-based layout
- Color-coded score bar
- Two action buttons

---

## ğŸ¨ Score Colors

| Score Range | Color | Progress Bar | Text Color |
|-------------|-------|--------------|------------|
| 70-100% | Green | `bg-green-500` | `text-green-600` |
| 40-69% | Orange | `bg-orange-500` | `text-orange-600` |
| 0-39% | Red | `bg-red-500` | `text-red-600` |

### Example Displays

**High Score (Supplies - 72%):**
```
72%
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ (green)
High likelihood to qualify as a business expense
```

**Medium Score (Travel - 58%):**
```
58%
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (orange)
Moderate likelihood to qualify as a business expense
```

**Low Score (Food - 35%):**
```
35%
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (red)
Low likelihood to qualify as a business expense
```

---

## ğŸ”„ Complete Technical Flow

```
1. User taps "Scan Receipt"
        â†“
2. Native iOS camera opens
        â†“
3. User takes photo
        â†“
4. Photo â†’ base64 encoding
        â†“
5. Show processing overlay
        â†“
6. HTTP POST to OpenRouter
   - API: openrouter.ai/api/v1/chat/completions
   - Model: google/gemini-2.0-flash-001
   - Body: { image: base64, prompt: "extract receipt data" }
        â†“
7. Gemini analyzes image (2-5 sec)
        â†“
8. Returns JSON response
        â†“
9. Parse JSON â†’ Receipt object
        â†“
10. Calculate score based on category
        â†“
11. Navigate to Confirmation Screen
        â†“
12. Display read-only summary
        â†“
13. User chooses:
    - "Retake" â†’ back to step 1
    - "Looks Good" â†’ save & go home
```

---

## âœ… Confirmation Screen Features

### Layout Sections
1. **Header**
   - Close button (X)
   - "Confirm Receipt" title

2. **Merchant Card**
   - Large merchant name
   - Date and category badges

3. **Amount Card**
   - Large total amount display

4. **Items Card**
   - List of line items
   - Prices and quantities
   - Subtotal and tax breakdown

5. **Score Card**
   - Percentage display
   - Color-coded progress bar
   - Likelihood description

6. **Actions Footer** (fixed at bottom)
   - Retake button (outline style)
   - Looks Good button (green, filled)

### All Text is Display-Only
- No input fields
- No text boxes
- No editable areas
- Pure read-only display

---

## ğŸš€ Ready to Test!

1. Open Xcode (already opened)
2. Add your OpenRouter API key to `.env`
3. Build and run on device (Cmd+R)
4. Navigate to Scan screen
5. Take a photo of any receipt
6. See the AI extract all data
7. Review the **non-editable** summary
8. Tap "Looks Good" to save!

---

**Model:** `google/gemini-2.0-flash-001` âœ…
**Confirmation:** Read-only display âœ…
**Flow:** Take â†’ Process â†’ Review â†’ Accept/Retake âœ…
